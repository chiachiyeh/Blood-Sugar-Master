<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>血糖控制大師</title>
    <!-- 引入 React 與 Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-slideUp { animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;

    // ===================================================================
    // ▼▼▼ 請在下方引號中填入你的 API Key ▼▼▼
    const DEFAULT_API_KEY = "AIzaSyCsAz6wI9Kn7ON36QP8Ncc8vakbpRVhlmQ"; 
    // ===================================================================

    // --- 圖示組件 (SVG) ---
    const Icon = ({ children, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            {children}
        </svg>
    );

    const Icons = {
        Activity: (props) => <Icon {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></Icon>,
        Utensils: (props) => <Icon {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></Icon>,
        Info: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>,
        CheckCircle2: (props) => <Icon {...props}><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></Icon>,
        AlertCircle: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>,
        Baby: (props) => <Icon {...props}><path d="M9 12h.01"/><path d="M15 12h.01"/><path d="M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5"/><path d="M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.8 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.8A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5-2-1-2-1.5.7-1.5 1.5-1.5c.5 0 1 .5 1 .5"/></Icon>,
        User: (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>,
        UserPlus: (props) => <Icon {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></Icon>,
        HeartPulse: (props) => <Icon {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27"/></Icon>,
        Hospital: (props) => <Icon {...props}><path d="M12 6V4"/><path d="M16.5 4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h3c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2Z"/><path d="M7.5 4c1.1 0 2 .9 2 2v14c0 1.1-.9 2-2 2h-3c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2Z"/><path d="M10 10h4"/><path d="M8 10h.01"/><path d="M16 10h.01"/><path d="M10 14h4"/><path d="M8 14h.01"/><path d="M16 14h.01"/></Icon>,
        UserCheck: (props) => <Icon {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></Icon>,
        Sparkles: (props) => <Icon {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/></Icon>,
        Loader2: (props) => <Icon {...props} className={`animate-spin ${props.className || ''}`}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></Icon>,
        Crown: (props) => <Icon {...props}><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></Icon>,
        ThumbsUp: (props) => <Icon {...props}><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></Icon>,
        ThumbsDown: (props) => <Icon {...props}><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"/></Icon>,
        XCircle: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></Icon>
    };

    // --- 資料庫定義 ---
    const GLUCOSE_STANDARDS = {
      // 1. 18歲以下
      child: {
        label: "18歲以下 (第一型糖尿病)",
        icon: <Icons.Baby />,
        targets: { 
            fasting: "90 - 130", 
            postMeal: "90 - 180", // 飯後
            bedtime: "90 - 150", // 睡前
            hba1c: "< 7.0", 
            note: "兒童需注意低血糖風險，睡前血糖標準較高。" 
        }
      },
      // 2. 20-65歲
      adult: {
        label: "20 - 65 歲 (成年糖友)",
        icon: <Icons.User />,
        targets: { 
            fasting: "80 - 130", 
            postMeal2h: "80 - 160", // 餐後2小時
            hba1c: "< 7.0\n(需個別化)", // 加上換行符號
            bp: "< 130/80", 
            note: [
                "不論第一、二型糖尿病，建議將血糖控制在合理範圍內。",
                "若年紀大、罹病長、有併發症或常低血糖，可放寬標準"
            ]
        }
      },
      // 3. 懷孕
      pregnant: {
        label: "懷孕婦女 (妊娠糖尿病)",
        icon: <Icons.UserPlus />,
        targets: { 
            fasting: "≤ 95", 
            postMeal1h: "≤ 140", 
            postMeal2h: "≤ 120", 
            hba1c: "< 6.0", 
            ga: "< 15.8", 
            note: [
                "懷孕期間控制需較嚴格",
                "懷孕可能有缺鐵性貧血或血量增加，可參考糖化白蛋白"
            ]
        }
      },
      // 4. 住院
      hospital: {
        label: "住院病人",
        icon: <Icons.Hospital />,
        targets: { range: "140 - 180", note: "住院期間血糖太高太低都有風險，維持在此範圍最安全。" }
      },
      // 5. 老年人
      elderly: {
        label: "65 歲以上老年人",
        icon: <Icons.User />,
        subCategories: {
          good: { status: "正常 (良好)", desc: "少共病症、認知及身體機能正常", targets: { fasting: "80 - 130", bedtime: "80 - 180", hba1c: "< 7 - 7.5", bp: "< 140/90" } },
          moderate: { status: "中等", desc: "多共病症、認知/身體機能輕微異常", targets: { fasting: "90 - 150", bedtime: "100 - 180", hba1c: "< 8.0", bp: "< 140/90" } },
          poor: { status: "差 (不佳)", desc: "末期慢性病、認知/身體機能嚴重異常", targets: { fasting: "100 - 180", bedtime: "110 - 200", hba1c: "不設定目標", bp: "< 150/90" } }
        }
      }
    };

    const CATEGORY_STYLES = {
      carb: { color: 'bg-yellow-100 border-yellow-400 text-yellow-900', label: '全穀雜糧' },
      protein: { color: 'bg-red-100 border-red-400 text-red-900', label: '豆魚蛋肉' },
      veg: { color: 'bg-green-100 border-green-400 text-green-900', label: '蔬菜類' },
      fruit: { color: 'bg-orange-100 border-orange-400 text-orange-900', label: '水果類' },
      dairy: { color: 'bg-blue-100 border-blue-400 text-blue-900', label: '乳品類' },
      fat: { color: 'bg-gray-100 border-gray-400 text-gray-800', label: '油脂堅果' },
      unknown: { color: 'bg-slate-100 border-slate-400 text-slate-800', label: '其他/未知' }
    };

    const App = () => {
      const apiKey = DEFAULT_API_KEY;
      
      const [activeTab, setActiveTab] = useState('glucose');
      
      // 狀態設定 (單一狀態，互斥)
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [elderlyHealth, setElderlyHealth] = useState('good');
      
      // 結果狀態
      const [resultProfile, setResultProfile] = useState(null);

      // AI 相關狀態
      const [foodInput, setFoodInput] = useState('');
      const [foodResult, setFoodResult] = useState(null);
      const [isAnalyzingFood, setIsAnalyzingFood] = useState(false);

      // --- 自動計算邏輯 (當選項改變時自動觸發) ---
      useEffect(() => {
        if (!selectedCategory) {
            setResultProfile(null);
            return;
        }

        if (selectedCategory === 'elderly') {
             setResultProfile({ 
                 type: 'elderly', 
                 data: GLUCOSE_STANDARDS.elderly, 
                 subType: elderlyHealth 
             });
        } else {
             setResultProfile({ 
                 type: selectedCategory, 
                 data: GLUCOSE_STANDARDS[selectedCategory] 
             });
        }
      }, [selectedCategory, elderlyHealth]);


      const checkApiKey = () => {
        if (!apiKey) {
            alert('尚未設定 API Key。請聯繫管理者在程式碼中填入 DEFAULT_API_KEY。');
            return false;
        }
        return true;
      };

      const analyzeFoodWithAI = async () => {
        if (!foodInput.trim()) return;
        if (!checkApiKey()) return;

        setIsAnalyzingFood(true);
        setFoodResult(null);

        // 更新的 Prompt: 強調 211 分類 與 推薦建議
        const prompt = `你是一位專業的糖尿病衛教師。請針對長輩，根據「211健康餐盤」概念分析食材：「${foodInput}」。
請回傳一個純 JSON 物件(不要有 markdown)，格式如下：
{
  "key": "veg"|"protein"|"carb"|"fruit"|"dairy"|"fat"|"unknown",
  "category": "類別名稱 (如: 蔬菜類、蛋白質、全穀雜糧)",
  "recommendation": "推薦食用 | 適量食用 | 盡量少吃",
  "reason": "給長輩的溫馨建議 (30字內)"
}
注意：
1. 蔬菜類(veg)包含葉菜、菇類、大番茄。
2. 澱粉類(carb)包含飯、麵、地瓜、南瓜、玉米、紅豆。
3. 蛋白質(protein)包含豆、魚、蛋、肉。
4. 若是加工食品或含糖高，請標示為「盡量少吃」。`;

        try {
          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
            {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            }
          );
          const data = await response.json();
          if(data.error) throw new Error(data.error.message);
          
          let text = data.candidates?.[0]?.content?.parts?.[0]?.text;
          text = text.replace(/```json/g, '').replace(/```/g, '').trim();
          const result = JSON.parse(text);
          const style = CATEGORY_STYLES[result.key] || CATEGORY_STYLES.unknown;
          setFoodResult({ ...result, ...style });
        } catch (error) {
          console.error(error);
          setFoodResult({
            category: "分析失敗", impact: "連線錯誤", portion: "-", advice: "無法連接 AI 服務: " + error.message,
            color: CATEGORY_STYLES.unknown.color, key: "unknown"
          });
        } finally {
          setIsAnalyzingFood(false);
        }
      };

      return (
        <div className="min-h-screen pb-20 max-w-md mx-auto bg-slate-50 border-x border-slate-200 shadow-2xl relative">
          
          {/* Header */}
          <header className="bg-emerald-600 text-white p-4 shadow-md sticky top-0 z-30 flex justify-between items-center">
            <div className="flex items-center gap-2">
              <Icons.Crown className="text-yellow-300 fill-yellow-300" />
              <h1 className="text-xl font-bold tracking-wider">血糖控制大師</h1>
            </div>
          </header>

          <div className="p-4">
            <div className="flex bg-white rounded-xl shadow-sm p-1 mb-6 sticky top-20 z-20">
              <button onClick={() => setActiveTab('glucose')} 
                className={`flex-1 py-2 rounded-lg text-sm font-bold flex flex-col items-center gap-1 transition ${activeTab === 'glucose' ? 'bg-emerald-100 text-emerald-700' : 'text-gray-400 hover:bg-gray-50'}`}>
                <Icons.Activity size={20} />
                <span className="text-xs">血糖試算</span>
              </button>
              <button onClick={() => setActiveTab('diet')} 
                className={`flex-1 py-2 rounded-lg text-sm font-bold flex flex-col items-center gap-1 transition ${activeTab === 'diet' ? 'bg-emerald-100 text-emerald-700' : 'text-gray-400 hover:bg-gray-50'}`}>
                <Icons.Utensils size={20} />
                <span className="text-xs">AI 飲食</span>
              </button>
            </div>

            {/* Content: 血糖 */}
            {activeTab === 'glucose' && (
              <div className="space-y-6 animate-fadeIn">
                <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                  <h2 className="font-bold text-lg mb-4 flex items-center gap-2 text-slate-700">
                    <Icons.Info size={20} className="text-emerald-500" /> 請選擇您的身分
                  </h2>
                  <div className="grid grid-cols-2 gap-3">
                     
                     {/* 選項 1: 18歲以下 */}
                     <button 
                        onClick={() => setSelectedCategory('child')}
                        className={`border p-3 rounded-xl transition flex flex-col items-center gap-1 ${selectedCategory === 'child' ? 'bg-emerald-50 border-emerald-500 text-emerald-700 ring-1 ring-emerald-500' : 'border-gray-200 hover:bg-slate-50'}`}
                     >
                        <Icons.Baby size={24} />
                        <span className="text-sm font-medium">18歲以下<br/>第一型糖尿病</span>
                     </button>

                     {/* 選項 2: 20-65歲 */}
                     <button 
                        onClick={() => setSelectedCategory('adult')}
                        className={`border p-3 rounded-xl transition flex flex-col items-center gap-1 ${selectedCategory === 'adult' ? 'bg-indigo-50 border-indigo-500 text-indigo-700 ring-1 ring-indigo-500' : 'border-gray-200 hover:bg-slate-50'}`}
                     >
                        <Icons.User size={24} />
                        <span className="text-sm font-medium">20-65歲<br/>成年糖友</span>
                     </button>

                     {/* 選項 3: 65歲以上 */}
                     <button 
                        onClick={() => setSelectedCategory('elderly')}
                        className={`border p-3 rounded-xl transition flex flex-col items-center gap-1 ${selectedCategory === 'elderly' ? 'bg-orange-50 border-orange-500 text-orange-700 ring-1 ring-orange-500' : 'border-gray-200 hover:bg-slate-50'}`}
                     >
                        <Icons.UserPlus size={24} />
                        <span className="text-sm font-medium">65歲以上<br/>老年糖友</span>
                     </button>

                     {/* 選項 4: 懷孕 */}
                     <button 
                        onClick={() => setSelectedCategory('pregnant')}
                        className={`border p-3 rounded-xl transition flex flex-col items-center gap-1 ${selectedCategory === 'pregnant' ? 'bg-pink-50 border-pink-500 text-pink-700 ring-1 ring-pink-500' : 'border-gray-200 hover:bg-slate-50'}`}
                     >
                        <Icons.Baby size={24} />
                        <span className="text-sm font-medium">懷孕糖友</span>
                     </button>

                      {/* 選項 5: 住院 */}
                      <button 
                        onClick={() => setSelectedCategory('hospital')}
                        className={`border p-3 rounded-xl transition flex flex-col items-center gap-1 col-span-2 ${selectedCategory === 'hospital' ? 'bg-blue-50 border-blue-500 text-blue-700 ring-1 ring-blue-500' : 'border-gray-200 hover:bg-slate-50'}`}
                     >
                        <Icons.Hospital size={24} />
                        <span className="text-sm font-medium">住院病人</span>
                     </button>
                  </div>

                  {/* 65歲以上額外選項 */}
                  {selectedCategory === 'elderly' && (
                    <div className="bg-orange-50 p-4 rounded-xl border border-orange-100 animate-fadeIn mt-4">
                      <label className="block text-sm font-bold text-orange-800 mb-2">健康狀況評估：</label>
                      <div className="space-y-2">
                        {Object.entries(GLUCOSE_STANDARDS.elderly.subCategories).map(([key, info]) => (
                          <label key={key} className="flex items-start gap-3 p-2 rounded-lg hover:bg-orange-100/50 cursor-pointer">
                            <input type="radio" name="elderlyHealth" value={key} checked={elderlyHealth === key} onChange={(e) => setElderlyHealth(e.target.value)} className="mt-1 accent-orange-500" />
                            <div><div className="font-bold text-gray-800 text-sm">{info.status}</div><div className="text-xs text-gray-500">{info.desc}</div></div>
                          </label>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                {/* 結果顯示區塊 (自動出現) */}
                {resultProfile && (
                  <div className="bg-white p-0 rounded-2xl shadow-lg border border-emerald-100 overflow-hidden animate-slideUp">
                    <div className={`p-4 text-white flex items-center gap-2 ${resultProfile.type === 'normal' ? 'bg-indigo-500' : 'bg-emerald-600'}`}>
                      {resultProfile.data.icon}
                      <span className="font-bold text-lg">{resultProfile.type === 'elderly' ? `老年人 - ${resultProfile.data.subCategories[resultProfile.subType].status}` : resultProfile.data.label}</span>
                    </div>
                    <div className="p-5 space-y-4">
                      <div className="grid grid-cols-2 gap-3">
                        {(() => {
                          const targets = resultProfile.type === 'elderly' ? resultProfile.data.subCategories[resultProfile.subType].targets : resultProfile.data.targets;
                          return Object.entries(targets).map(([key, value]) => {
                            if (key === 'note') return null;
                            const labels = { fasting: '空腹血糖', postMeal: '飯後血糖', postMeal1h: '飯後1H', postMeal2h: '飯後2H', bedtime: '睡前血糖', hba1c: '糖化血色素 (HbA1c)', bp: '血壓', ga: '糖化白蛋白', range: '血糖範圍' };
                            return (
                              <div key={key} className="bg-gray-50 p-3 rounded-xl text-center border border-gray-100 flex flex-col justify-center min-h-[80px]">
                                <div className="text-xs text-gray-500 mb-1">{labels[key] || key}</div>
                                <div className="text-xl font-bold text-emerald-600 whitespace-pre-line leading-tight">{value}</div>
                                {key === 'hba1c' && value.indexOf('需個別化') === -1 && <div className="text-[10px] text-gray-400">%</div>}
                                {key === 'ga' && <div className="text-[10px] text-gray-400">%</div>}
                                {(key.includes('Meal') || key === 'fasting' || key === 'bedtime' || key === 'range') && <div className="text-[10px] text-gray-400">mg/dL</div>}
                                {key === 'bp' && <div className="text-[10px] text-gray-400">mmHg</div>}
                              </div>
                            );
                          });
                        })()}
                      </div>
                      
                      {/* 注意事項 Note 顯示區 */}
                      {(() => {
                          const noteContent = resultProfile.type === 'elderly' ? "醫師備註：隨著健康狀況變差，目標可適度放寬，避免低血糖。" : resultProfile.data.targets.note;
                          
                          return (
                            <div className="bg-yellow-50 text-yellow-800 text-sm p-3 rounded-lg flex gap-2 items-start">
                                <Icons.AlertCircle size={16} className="mt-0.5 shrink-0" />
                                <div className="flex-1">
                                    {Array.isArray(noteContent) ? (
                                        <ul className="list-disc pl-4 space-y-1">
                                            {noteContent.map((item, idx) => (
                                                <li key={idx}>{item}</li>
                                            ))}
                                        </ul>
                                    ) : (
                                        <p>{noteContent}</p>
                                    )}
                                </div>
                            </div>
                          );
                      })()}
                      
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* Content: AI 飲食 (更新為 211 餐盤分類邏輯 + 改善輸入框) */}
            {activeTab === 'diet' && (
              <div className="space-y-6 animate-fadeIn">
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center">
                  <h3 className="font-bold text-slate-700 mb-4">211 健康餐盤</h3>
                  {/* Visual Plate */}
                  <div className="relative w-64 h-64 rounded-full border-4 border-slate-200 overflow-hidden shadow-inner flex flex-wrap bg-white">
                    <div className={`w-1/2 h-full border-r border-white flex items-center justify-center p-2 text-center transition-colors duration-500 ${foodResult?.key === 'veg' ? 'bg-green-500 text-white' : 'bg-green-100 text-green-800'}`}>
                      <div><div className="font-bold text-lg">蔬菜類</div><div className="text-xs">1/2 盤</div></div>
                    </div>
                    <div className="w-1/2 h-full flex flex-col">
                      <div className={`h-1/2 w-full border-b border-white flex items-center justify-center p-1 text-center transition-colors duration-500 ${foodResult?.key === 'protein' ? 'bg-red-500 text-white' : 'bg-red-100 text-red-800'}`}>
                         <div><div className="font-bold">蛋白質</div><div className="text-xs">1/4 盤</div></div>
                      </div>
                      <div className={`h-1/2 w-full flex items-center justify-center p-1 text-center transition-colors duration-500 ${foodResult?.key === 'carb' ? 'bg-yellow-400 text-yellow-900' : 'bg-yellow-100 text-yellow-800'}`}>
                        <div><div className="font-bold">全穀類</div><div className="text-xs">1/4 盤</div></div>
                      </div>
                    </div>
                  </div>
                  <p className="text-xs text-gray-500 mt-4">口訣：菜吃多、肉適量、飯少吃</p>
                </div>

                <div className="bg-white p-5 rounded-2xl shadow-lg border border-indigo-50 relative overflow-hidden">
                  <div className="absolute top-0 right-0 p-2 opacity-10"><Icons.Sparkles size={80} className="text-indigo-500"/></div>
                  <label className="block text-sm font-bold text-indigo-900 mb-2 flex items-center gap-2">
                    <Icons.Sparkles size={16} className="text-indigo-500" /> AI 食材分析
                  </label>
                  
                  {/* 輸入框 + 一鍵清除按鈕 */}
                  <div className="flex gap-2 mb-4 relative">
                    <div className="relative flex-1">
                        <input 
                            type="text" 
                            value={foodInput} 
                            onChange={(e) => setFoodInput(e.target.value)} 
                            onKeyDown={(e) => e.key === 'Enter' && analyzeFoodWithAI()} 
                            placeholder="輸入食材 (如: 地瓜、香腸)..." 
                            className="w-full p-3 pr-10 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:outline-none" 
                        />
                        {foodInput && (
                            <button 
                                onClick={() => setFoodInput('')}
                                className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 bg-white rounded-full"
                                aria-label="清除輸入"
                            >
                                <Icons.XCircle size={20} />
                            </button>
                        )}
                    </div>
                    <button onClick={analyzeFoodWithAI} disabled={isAnalyzingFood || !foodInput.trim()} className="bg-indigo-600 text-white px-4 rounded-xl font-bold shadow hover:bg-indigo-700 active:scale-95 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shrink-0">
                      {isAnalyzingFood ? <Icons.Loader2 size={20} className="animate-spin" /> : '分析'}
                    </button>
                  </div>

                  {foodResult && (
                    <div className={`p-4 rounded-xl border-l-4 animate-slideUp ${foodResult.color}`}>
                      <div className="flex justify-between items-start mb-3">
                        <span className="font-bold text-lg">{foodResult.category}</span>
                        {/* 推薦程度 Badge */}
                        {foodResult.recommendation && (
                            <span className={`text-xs px-2 py-1 rounded-full font-bold shadow-sm flex items-center gap-1
                                ${foodResult.recommendation.includes('推薦') ? 'bg-emerald-200 text-emerald-800' : 
                                  foodResult.recommendation.includes('少吃') ? 'bg-red-200 text-red-800' : 'bg-yellow-200 text-yellow-800'}`}>
                                {foodResult.recommendation.includes('推薦') ? <Icons.ThumbsUp size={12}/> : 
                                 foodResult.recommendation.includes('少吃') ? <Icons.ThumbsDown size={12}/> : <Icons.Info size={12}/>}
                                {foodResult.recommendation}
                            </span>
                        )}
                      </div>
                      <div className="space-y-2 text-sm">
                        <div className="flex items-start gap-2 bg-white/50 p-2 rounded-lg">
                           <Icons.Info size={16} className="mt-0.5 opacity-70 shrink-0" />
                           <span className="leading-relaxed font-medium">{foodResult.reason}</span>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>

</body>
</html>